import { CloudSDK } from '@sitecore-cloudsdk/core/browser';
import { pageView } from "@sitecore-cloudsdk/events/browser";
import { personalize } from "@sitecore-cloudsdk/personalize/browser";
import { getPageWidgetData, sendConversionEvent } from '@sitecore-cloudsdk/search-api-client/browser';
import React, { useEffect, useState, useCallback } from "react";

function Home() {
  const eventData = {
    channel: "WEB",
    currency: "EUR",
    language: "EN",
    page: "async-init-events",
  };

  const personalizeData = { ...eventData, friendlyId: "personalizeintegrationtest" };
  const searchData = {
    currency: "EUR",
    language: "EN",
    page: "test",
    pathname: "https://www.sitecore.com/products/content-cloud",
    entity: {
      attributes: {
        author: "ABC"
      },
      entity: "category",
      entityType: "subcat",
      id: "123",
      sourceId: "534",
      uri: "https://www.sitecore.com/products/content-cloud"
    }
  };

  const initCloudSDK = useCallback(async () => {
     await CloudSDK({
        enableBrowserCookie: true,
        siteName: "spinair.com",
        sitecoreEdgeContextId: "83d8199c-2837-4c29-a8ab-1bf234fea2d1"
      })
        .addEvents()
        .addPersonalize()
        .addSearch({ userId: 'test' })
        .initialize();
  }, []);

  useEffect(() => {
    initCloudSDK();
  }, [initCloudSDK]);

  const handleSendEvent = async () => {
    await pageView(eventData);
  };

  const handleSendPersonalize = async () => {
    await personalize(personalizeData);
  };

  const handleSendConversionEvent = async () => {
    await sendConversionEvent(searchData);
  };

  const handleSendSearch = async () => {
    await getPageWidgetData('/test');
  };

  return (
    <div className="Home">
      <header className="Home-header">
        <p>Create-next-app installation test</p>
        <button data-testid="sendEventBtn" onClick={handleSendEvent}>
          Send event
        </button>
        <button data-testid="sendPersonalizeBtn" onClick={handleSendPersonalize}>
          Send personalize
        </button>
        <button data-testid="sendSearchBtn" onClick={handleSendSearch}>
          Send search
        </button>
        <button data-testid="sendConversionEventBtn" onClick={handleSendConversionEvent}>
          Send conversionEvent
        </button>
      </header>
    </div>
  );
}

export default Home;
